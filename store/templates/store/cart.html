{% extends 'store/base.html' %}
{% load static %}

{% block content %}
<div class="container py-5">
  <h2 class="text-center mb-5" style="color: #111; font-weight: 600;">Ваша корзина</h2>

  {% if items %}
  <div class="row row-cols-1 g-5">
    {% for item in items %}
    <div class="col">
      <div class="p-4 bg-white border rounded-4 shadow-sm d-flex flex-wrap align-items-center gap-4">

        <!-- Фото -->
        <img src="{{ item.product.image.url }}" alt="{{ item.product.name }}" class="rounded-3" style="width: 160px; height: 160px; object-fit: cover; flex-shrink: 0;">

        <!-- Инфо -->
        <div class="flex-grow-1" style="min-width: 220px;">
          <h4 class="mb-1" style="font-weight: 600;">{{ item.product.name }}</h4>
          <p class="mb-1 text-muted">{{ item.product.brand.name }}</p>
          <p class="mb-0" style="font-size: 1.1rem; color: #444;">{{ item.product.calculated_price }} ₸ / шт</p>
        </div>

        <!-- Кол-во -->
        <div class="d-flex align-items-center gap-2">
          <form method="post" action="{% url 'increase' item.product.pk %}">
            {% csrf_token %}
            <button class="btn btn-outline-dark btn-sm px-3">+</button>
          </form>

          <span class="fw-bold fs-5">{{ item.quantity }}</span>

          <form method="post" action="{% url 'remove_from_cart' item.product.pk %}">
            {% csrf_token %}
            <button class="btn btn-outline-dark btn-sm px-3">-</button>
          </form>
        </div>

        <!-- Итого -->
        <div class="text-end ms-auto">
          <p class="mb-0 fw-semibold" style="font-size: 1.2rem; color: #d4af37;">{{ item.item_total }} ₸</p>
        </div>
      </div>
    </div>
    {% endfor %}
  </div>

  <!-- Общая сумма -->
  <div class="text-end mt-5">
    <h3 style="font-weight: 600;">Итого: <span style="color: #d4af37;">{{ total_price }} ₸</span></h3>
  </div>

  <!-- Кнопки -->
  <div class="d-flex justify-content-center gap-4 mt-4">
    <a href="{% url 'checkout' %}" class="btn btn-dark px-5 py-3 fw-bold">Оформить заказ</a>
    <a href="{% url 'products_list' %}" class="btn btn-outline-secondary px-5 py-3">Продолжить покупки</a>
  </div>

  {% else %}
  <p class="text-center text-muted fs-4">Корзина пуста.</p>
  <div class="text-center mt-3">
    <a href="{% url 'products_list' %}" class="btn btn-dark px-4 py-2 fw-bold">Начать покупки</a>
  </div>
  {% endif %}
</div>
{% endblock %}
